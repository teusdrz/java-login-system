### Java Login System - Notification API Tests
### Base URL: http://localhost:8080/api/v1

@baseUrl = http://localhost:8080/api/v1
@contentType = application/json
@authToken = your-jwt-token-here
@adminToken = admin-jwt-token-here

###########################################################################
# üîî NOTIFICATION MANAGEMENT TESTS
###########################################################################

### 1. ‚úâÔ∏è Send Notification - Info Message
POST {{baseUrl}}/notifications/send
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "title": "Test Notification {{$timestamp}}",
  "message": "This is a test notification sent via API testing",
  "type": "INFO",
  "priority": "MEDIUM",
  "recipientUsername": "testuser",
  "expirationTime": "2025-12-31T23:59:59Z",
  "requiresAcknowledgment": false
}

### 2. ‚ö†Ô∏è Send Warning Notification
POST {{baseUrl}}/notifications/send
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "title": "Warning: System Maintenance",
  "message": "Scheduled maintenance will begin in 1 hour. Please save your work.",
  "type": "WARNING",
  "priority": "HIGH",
  "recipientUsername": "admin",
  "expirationTime": "2025-08-28T12:00:00Z",
  "requiresAcknowledgment": true
}

### 3. üö® Send Critical Alert
POST {{baseUrl}}/notifications/send
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "title": "CRITICAL: Security Alert",
  "message": "Suspicious login activity detected on your account.",
  "type": "ALERT",
  "priority": "CRITICAL",
  "recipientUsername": "moderator",
  "expirationTime": "2025-08-30T23:59:59Z",
  "requiresAcknowledgment": true
}

### 4. üì¢ Send System Announcement
POST {{baseUrl}}/notifications/send
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "title": "System Update Available",
  "message": "A new system update is available. Please review the changelog.",
  "type": "SYSTEM",
  "priority": "LOW",
  "recipientUsername": "testuser",
  "expirationTime": "2025-09-15T00:00:00Z",
  "requiresAcknowledgment": false
}

### 5. ‚ùå Send Notification - Invalid Recipient
POST {{baseUrl}}/notifications/send
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "title": "Invalid Recipient Test",
  "message": "This should fail",
  "type": "INFO",
  "priority": "MEDIUM",
  "recipientUsername": "nonexistent_user",
  "requiresAcknowledgment": false
}

### 6. ‚ùå Send Notification - Missing Required Fields
POST {{baseUrl}}/notifications/send
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "title": "Incomplete Notification",
  "message": ""
}

### 7. ‚ùå Send Notification - Invalid Priority
POST {{baseUrl}}/notifications/send
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "title": "Invalid Priority Test",
  "message": "Testing invalid priority",
  "type": "INFO",
  "priority": "INVALID_PRIORITY",
  "recipientUsername": "testuser"
}

### 8. ‚ùå Send Notification - Non-Admin Access
POST {{baseUrl}}/notifications/send
Content-Type: {{contentType}}
Authorization: Bearer {{authToken}}

{
  "title": "Unauthorized Send",
  "message": "This should fail",
  "type": "INFO",
  "priority": "MEDIUM",
  "recipientUsername": "admin"
}

###########################################################################
# üì¨ NOTIFICATION RETRIEVAL TESTS
###########################################################################

### 9. üìã Get User Notifications - All
GET {{baseUrl}}/notifications?page=0&size=20
Authorization: Bearer {{authToken}}
Accept: {{contentType}}

### 10. üëÅÔ∏è Get Unread Notifications Only
GET {{baseUrl}}/notifications?unreadOnly=true
Authorization: Bearer {{authToken}}
Accept: {{contentType}}

### 11. üìã Get Notifications - Pagination
GET {{baseUrl}}/notifications?page=1&size=5&sortBy=createdAt&sortDirection=DESC
Authorization: Bearer {{authToken}}
Accept: {{contentType}}

### 12. üîç Filter Notifications by Type
GET {{baseUrl}}/notifications?type=WARNING
Authorization: Bearer {{authToken}}
Accept: {{contentType}}

### 13. üîç Filter Notifications by Priority
GET {{baseUrl}}/notifications?priority=HIGH
Authorization: Bearer {{authToken}}
Accept: {{contentType}}

### 14. üìÖ Filter Notifications by Date Range
GET {{baseUrl}}/notifications?startDate=2025-08-01&endDate=2025-08-31
Authorization: Bearer {{authToken}}
Accept: {{contentType}}

### 15. üîç Get Notification by ID
GET {{baseUrl}}/notifications/1
Authorization: Bearer {{authToken}}
Accept: {{contentType}}

### 16. ‚ùå Get Non-existent Notification
GET {{baseUrl}}/notifications/99999
Authorization: Bearer {{authToken}}
Accept: {{contentType}}

### 17. ‚ùå Get Notifications - No Authorization
GET {{baseUrl}}/notifications
Accept: {{contentType}}

###########################################################################
# ‚úÖ NOTIFICATION INTERACTION TESTS
###########################################################################

### 18. ‚úÖ Mark Notification as Read
PUT {{baseUrl}}/notifications/1/read
Authorization: Bearer {{authToken}}

### 19. ‚úÖ Mark Multiple Notifications as Read
PUT {{baseUrl}}/notifications/bulk/read
Content-Type: {{contentType}}
Authorization: Bearer {{authToken}}

{
  "notificationIds": [1, 2, 3]
}

### 20. ‚úÖ Acknowledge Notification
PUT {{baseUrl}}/notifications/2/acknowledge
Content-Type: {{contentType}}
Authorization: Bearer {{authToken}}

{
  "acknowledgmentNote": "Acknowledged via API test"
}

### 21. ‚ùå Mark Non-existent Notification as Read
PUT {{baseUrl}}/notifications/99999/read
Authorization: Bearer {{authToken}}

### 22. ‚ùå Mark Notification as Read - Unauthorized
PUT {{baseUrl}}/notifications/1/read
Authorization: Bearer invalid-token

### 23. üóëÔ∏è Delete Notification
DELETE {{baseUrl}}/notifications/3
Authorization: Bearer {{authToken}}

### 24. ‚ùå Delete Non-existent Notification
DELETE {{baseUrl}}/notifications/99999
Authorization: Bearer {{authToken}}

### 25. ‚ùå Delete Notification - No Authorization
DELETE {{baseUrl}}/notifications/1

###########################################################################
# üì¢ BROADCAST NOTIFICATION TESTS
###########################################################################

### 26. üì¢ Broadcast to All Users
POST {{baseUrl}}/notifications/broadcast
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "title": "System-wide Announcement {{$timestamp}}",
  "message": "This is a system-wide broadcast message for all users.",
  "type": "SYSTEM",
  "priority": "MEDIUM",
  "targetRoles": ["USER", "ADMIN", "MODERATOR"],
  "expirationTime": "2025-12-31T23:59:59Z",
  "requiresAcknowledgment": false
}

### 27. üì¢ Broadcast to Specific Roles
POST {{baseUrl}}/notifications/broadcast
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "title": "Admin Broadcast {{$timestamp}}",
  "message": "This message is only for administrators and moderators.",
  "type": "SYSTEM",
  "priority": "HIGH",
  "targetRoles": ["ADMIN", "MODERATOR"],
  "expirationTime": "2025-09-30T23:59:59Z",
  "requiresAcknowledgment": true
}

### 28. üì¢ Emergency Broadcast
POST {{baseUrl}}/notifications/broadcast
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "title": "EMERGENCY: System Security Alert",
  "message": "Immediate action required: Security breach detected. All users must change passwords.",
  "type": "ALERT",
  "priority": "CRITICAL",
  "targetRoles": ["USER", "ADMIN", "MODERATOR"],
  "expirationTime": "2025-08-28T23:59:59Z",
  "requiresAcknowledgment": true
}

### 29. ‚ùå Broadcast - Invalid Role Target
POST {{baseUrl}}/notifications/broadcast
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "title": "Invalid Broadcast",
  "message": "This should fail",
  "type": "INFO",
  "priority": "MEDIUM",
  "targetRoles": ["INVALID_ROLE"]
}

### 30. ‚ùå Broadcast - Non-Admin Access
POST {{baseUrl}}/notifications/broadcast
Content-Type: {{contentType}}
Authorization: Bearer {{authToken}}

{
  "title": "Unauthorized Broadcast",
  "message": "This should fail",
  "type": "INFO",
  "priority": "MEDIUM",
  "targetRoles": ["USER"]
}

###########################################################################
# üìä NOTIFICATION STATISTICS TESTS
###########################################################################

### 31. üìà Get Notification Statistics - User View
GET {{baseUrl}}/notifications/stats
Authorization: Bearer {{authToken}}
Accept: {{contentType}}

### 32. üìà Get Notification Statistics - Admin View
GET {{baseUrl}}/notifications/stats/admin
Authorization: Bearer {{adminToken}}
Accept: {{contentType}}

### 33. üìä Get Notification Statistics by Type
GET {{baseUrl}}/notifications/stats/types
Authorization: Bearer {{adminToken}}
Accept: {{contentType}}

### 34. üìä Get Notification Statistics by Priority
GET {{baseUrl}}/notifications/stats/priorities
Authorization: Bearer {{adminToken}}
Accept: {{contentType}}

### 35. üìÖ Get Notification Statistics - Time-based
GET {{baseUrl}}/notifications/stats/timeline?period=DAILY&days=7
Authorization: Bearer {{adminToken}}
Accept: {{contentType}}

### 36. üìä Get Delivery Statistics
GET {{baseUrl}}/notifications/stats/delivery
Authorization: Bearer {{adminToken}}
Accept: {{contentType}}

### 37. üìà Get User Engagement Statistics
GET {{baseUrl}}/notifications/stats/engagement
Authorization: Bearer {{adminToken}}
Accept: {{contentType}}

### 38. ‚ùå Get Admin Statistics - Non-Admin Access
GET {{baseUrl}}/notifications/stats/admin
Authorization: Bearer {{authToken}}
Accept: {{contentType}}

###########################################################################
# üßπ NOTIFICATION MAINTENANCE TESTS
###########################################################################

### 39. üßπ Cleanup Expired Notifications
POST {{baseUrl}}/notifications/cleanup
Authorization: Bearer {{adminToken}}

### 40. üßπ Cleanup Read Notifications (Older than 30 days)
POST {{baseUrl}}/notifications/cleanup/read
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "olderThanDays": 30,
  "keepUnread": true,
  "dryRun": true
}

### 41. üßπ Archive Old Notifications
POST {{baseUrl}}/notifications/archive
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "olderThanDays": 90,
  "archiveRead": true,
  "archiveAcknowledged": true
}

### 42. üìä Get Cleanup Statistics
GET {{baseUrl}}/notifications/cleanup/stats
Authorization: Bearer {{adminToken}}
Accept: {{contentType}}

### 43. ‚ùå Cleanup Notifications - Non-Admin Access
POST {{baseUrl}}/notifications/cleanup
Authorization: Bearer {{authToken}}

###########################################################################
# üö® ALERT MANAGEMENT TESTS
###########################################################################

### 44. üö® Get System Alerts
GET {{baseUrl}}/notifications/alerts
Authorization: Bearer {{adminToken}}
Accept: {{contentType}}

### 45. üö® Get Active Alerts Only
GET {{baseUrl}}/notifications/alerts?status=ACTIVE
Authorization: Bearer {{adminToken}}
Accept: {{contentType}}

### 46. üö® Get Critical Alerts
GET {{baseUrl}}/notifications/alerts?severity=CRITICAL
Authorization: Bearer {{adminToken}}
Accept: {{contentType}}

### 47. üö® Get High Priority Alerts
GET {{baseUrl}}/notifications/alerts?severity=HIGH
Authorization: Bearer {{adminToken}}
Accept: {{contentType}}

### 48. üîï Acknowledge Alert
PUT {{baseUrl}}/notifications/alerts/1/acknowledge
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "acknowledgmentNote": "Alert reviewed and acknowledged by admin via API."
}

### 49. üîï Dismiss Alert
PUT {{baseUrl}}/notifications/alerts/2/dismiss
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "dismissalReason": "False positive - no action required"
}

### 50. üö® Create Security Alert
POST {{baseUrl}}/notifications/alerts/security
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "title": "Security Incident Detected",
  "description": "Multiple failed login attempts from suspicious IP",
  "severity": "HIGH",
  "source": "SecurityMonitor",
  "affectedUsers": ["admin", "moderator"],
  "recommendedActions": ["Review logs", "Check IP restrictions", "Notify users"]
}

### 51. ‚ùå Get Alerts - Non-Admin Access
GET {{baseUrl}}/notifications/alerts
Authorization: Bearer {{authToken}}
Accept: {{contentType}}

### 52. ‚ùå Acknowledge Alert - Insufficient Permissions
PUT {{baseUrl}}/notifications/alerts/1/acknowledge
Content-Type: {{contentType}}
Authorization: Bearer {{authToken}}

{
  "acknowledgmentNote": "Should fail"
}

###########################################################################
# üîî NOTIFICATION PREFERENCES TESTS
###########################################################################

### 53. ‚öôÔ∏è Get User Notification Preferences
GET {{baseUrl}}/notifications/preferences
Authorization: Bearer {{authToken}}
Accept: {{contentType}}

### 54. ‚öôÔ∏è Update Notification Preferences
PUT {{baseUrl}}/notifications/preferences
Content-Type: {{contentType}}
Authorization: Bearer {{authToken}}

{
  "emailNotifications": true,
  "smsNotifications": false,
  "pushNotifications": true,
  "notificationTypes": {
    "INFO": true,
    "WARNING": true,
    "ALERT": true,
    "SYSTEM": true
  },
  "quietHours": {
    "enabled": true,
    "startTime": "22:00",
    "endTime": "07:00"
  }
}

### 55. ‚öôÔ∏è Get Default Notification Settings
GET {{baseUrl}}/notifications/preferences/defaults
Authorization: Bearer {{adminToken}}
Accept: {{contentType}}

### 56. ‚öôÔ∏è Update Default Notification Settings (Admin)
PUT {{baseUrl}}/notifications/preferences/defaults
Content-Type: {{contentType}}
Authorization: Bearer {{adminToken}}

{
  "defaultEmailNotifications": true,
  "defaultPushNotifications": true,
  "maxNotificationsPerDay": 50,
  "autoCleanupAfterDays": 30
}

### 57. ‚ùå Update Default Settings - Non-Admin Access
PUT {{baseUrl}}/notifications/preferences/defaults
Content-Type: {{contentType}}
Authorization: Bearer {{authToken}}

{
  "defaultEmailNotifications": false
}

###########################################################################
# üì± NOTIFICATION DELIVERY TESTS
###########################################################################

### 58. üì± Get Notification Delivery Status
GET {{baseUrl}}/notifications/1/delivery
Authorization: Bearer {{authToken}}
Accept: {{contentType}}

### 59. üì± Get Failed Deliveries
GET {{baseUrl}}/notifications/delivery/failed
Authorization: Bearer {{adminToken}}
Accept: {{contentType}}

### 60. üì± Retry Failed Delivery
POST {{baseUrl}}/notifications/1/retry
Authorization: Bearer {{adminToken}}

### 61. üìä Get Delivery Report
GET {{baseUrl}}/notifications/delivery/report?days=7
Authorization: Bearer {{adminToken}}
Accept: {{contentType}}

### 62. ‚ùå Get Delivery Status - Unauthorized
GET {{baseUrl}}/notifications/1/delivery
Authorization: Bearer invalid-token
Accept: {{contentType}}

###########################################################################
# üîç NOTIFICATION SEARCH TESTS
###########################################################################

### 63. üîç Search Notifications by Content
GET {{baseUrl}}/notifications/search?query=security&page=0&size=10
Authorization: Bearer {{authToken}}
Accept: {{contentType}}

### 64. üîç Advanced Notification Search
GET {{baseUrl}}/notifications/search?query=system&type=SYSTEM&priority=HIGH&read=false
Authorization: Bearer {{authToken}}
Accept: {{contentType}}

### 65. üîç Search by Sender
GET {{baseUrl}}/notifications/search?sender=admin
Authorization: Bearer {{authToken}}
Accept: {{contentType}}

### 66. üîç Search by Tags
GET {{baseUrl}}/notifications/search?tags=security,alert
Authorization: Bearer {{authToken}}
Accept: {{contentType}}

### 67. ‚ùå Search Notifications - Invalid Query
GET {{baseUrl}}/notifications/search?query=
Authorization: Bearer {{authToken}}
Accept: {{contentType}}

###########################################################################
# üìù TEST EXECUTION NOTES
###########################################################################

# Test Categories:
# ‚úÖ = Should succeed (expect 200, 201, 204 status codes)
# ‚ùå = Should fail (expect 400, 401, 403, 404 status codes)
# üìî = Read operations
# ‚úâÔ∏è = Send operations
# üóëÔ∏è = Delete operations
# üì¢ = Broadcast operations

# Prerequisites:
# 1. Admin token from successful admin login
# 2. Regular user token for user-level operations
# 3. System should be running on localhost:8080
# 4. Test users (admin, moderator, testuser) should exist

# Expected Behaviors:
# - Regular users can only see their own notifications
# - Admin users can send notifications to any user
# - Broadcast requires admin privileges
# - Cleanup operations require admin privileges
# - Alert management requires admin privileges

# Audit Expectations:
# - All notification operations should generate audit logs
# - Failed permission attempts should be logged
# - Broadcast operations should create detailed audit entries
# - Alert acknowledgments should be audited

# Performance Considerations:
# - Notification listing should support pagination
# - Search operations should be efficient
# - Bulk operations should be atomic
# - Cleanup operations should not impact performance
